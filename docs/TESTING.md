# Testing

## Hierarchy

Avoid overlap between levels.

| Level | Purpose | Mocking |
|-------|---------|---------|
| **E2E** | Happy paths via real examples | None |
| **Integration** | Edge cases, error handling | External boundaries only |
| **Unit** | Pure logic, branches | Everything |

### File Patterns

| Language | E2E | Integration | Unit | Location |
|----------|-----|-------------|------|----------|
| TypeScript | `*.e2e.test.ts` | `*.integration.test.ts` | `*.unit.test.ts` | `__tests__/` |
| Python | `test_*_e2e.py` | `test_*_integration.py` | `test_*.py` | `tests/` |
| Go | `*_e2e_test.go` | `*_integration_test.go` | `*_test.go` | same package |

## Workflow

1. **Spec first**: Write `.feature` in `specs/`. Tags: `@e2e`, `@integration`, `@unit`
2. **Challenge**: Reviewer challenges missing edge cases before implementation
3. **Examples drive E2E**: Working examples in `examples/` are wrapped by e2e tests
4. **Implement**: Outside-in TDD. Red → Green → Refactor

## Decision Tree

```text
Happy path demonstrating SDK usage? → E2E (wrap an example)
Orchestration between modules or external API? → Integration (mock boundaries)
Pure logic or single class? → Unit (mock collaborators)
Regression from production? → LOWEST sufficient level (unit > integration > e2e)
```

## Scenario Design

Each scenario tests **one invariant**.

- **Extend** (add `And`/`But`): New assertion is natural consequence of same behavior
- **New scenario**: Assertion tests distinct invariant that could fail independently

## What We Don't Test

- Type definitions
- Simple pass-throughs with no logic
- Third-party library internals
- Constants/config (unless dynamic)

## E2E Patterns (Playwright)

Project-specific conventions for `agentic-e2e-tests/`:

| Pattern | Convention |
|---------|------------|
| Sidebar navigation | Always use `{ name: 'X', exact: true }` |
| Dialogs (Chakra) | Use `.last()` to handle duplicate renders |
| Auth state | Stored in `.auth/user.json`, reused across tests |
| Test naming | Action-based, no "should" (see `CLAUDE.md`) |

### Agentic Workflow

```text
specs/*.feature → Planner → plans/*.plan.md → Generator → tests/*.spec.ts
                                                              ↓
                                                          Healer (on failure)
```

- Specs are source of truth
- Plans are generated by exploring live app
- Tests are generated from plans
- Healer fixes failing tests by inspecting UI

See `agentic-e2e-tests/README.md` for setup and running tests.
